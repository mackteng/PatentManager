function authentication(a,b,c){var d=b.baseUrl,e=function(b){a.localStorage.token=b},f=function(b){return a.localStorage.token},g=function(a){return c.post(d+"register/",a).success(function(a){e(a)})},h=function(a){return c.post(d+"login/",a).success(function(a){e(a)})},i=function(){a.localStorage.removeItem("loc8r-token")},j=function(){var b=f();if(b){var c=JSON.parse(a.atob(b.split(".")[1]));return c.exp>Date.now()/1e3}return!1},k=function(){if(j()){var b=f(),c=JSON.parse(a.atob(b.split(".")[1]));return{email:c.email,name:c.name}}};return{saveToken:e,getToken:f,register:g,login:h,logout:i,isLoggedIn:j,currentUser:k}}function loginController(a,b){var c=this;c.error="",c.login=function(){c.email&&c.password?a.login({email:c.email,password:c.password}).error(function(a){c.error=a.message,c.email="",c.password=""}).then(function(){b.go("overview")}):alert("Both fields must be filled in")}}function clientService(a,b,c){var d=b.baseUrl,e={};return e.listAllClients=function(){return a.get(d+"clients/",{headers:{Authorization:"Bearer "+c.getToken()}})},e.addNewClient=function(b){return a.post(d+"clients/",b,{headers:{Authorization:"Bearer "+c.getToken()}})},e.updateClient=function(b){return a.put(d+"clients/"+b._id,b,{headers:{Authorization:"Bearer "+c.getToken()}})},e}function eventService(a,b,c){var d=b.baseUrl,e={};return e.listAllEvents=function(){return a.get(d+"/events",{headers:{Authorization:"Bearer "+c.getToken()}})},e.getEventHistory=function(b){return a.get(d+"/patents/"+b+"/events",{headers:{Authorization:"Bearer "+c.getToken()}})},e.addEvent=function(b,e){return a.post(d+"/patents/"+b+"/events",e,{headers:{Authorization:"Bearer "+c.getToken()}})},e.completeEvent=function(b){return a.put(d+"/events/"+b,{complete:!0},{headers:{Authorization:"Bearer "+c.getToken()}})},e.deleteEvent=function(b){return a["delete"](d+"/events/"+b,{headers:{Authorization:"Bearer "+c.getToken()}})},e}function calendarController(a){var b=this;b.events=a.data,b.eventSources={events:[]},b.config={calendar:{height:800,header:{left:"month basicWeek basicDay",center:"title",right:"today prev,next"}}};for(var c=0;c<b.events.length;c++)0==b.events[c].completed&&b.eventSources.events.push({title:b.events[c].eventName,start:new Date(b.events[c].eventDeadline),url:"#/manage/"+b.events[c].patentID})}function clientDetailsController(a,b,c){var d=this;d.clients=b.allClients;for(var e=0;e<d.clients.length;e++)if(d.clients[e]._id===a.clientid){d.client=d.clients[e];break}d.addContact=function(){d.editEnabled&&d.client.contacts.push({})},d.deleteContact=function(a){d.editEnabled&&d.client.contacts.splice(a,1)},d.editEnabled=!1,d.oldClient=null,d.enableEdit=function(){d.oldClient=angular.copy(d.client),d.editEnabled=!0},d.cancelEdit=function(){angular.copy(d.oldPatent,d.patent),d.editEnabled=!1},d.save=function(){c.updateClient(d.client,d.client._id).success(function(){angular.copy(d.client,d.oldClient),d.editEnabled=!1}).error(function(a){alert(a),d.cancelEdit()})}}function newClientFormController(a,b){var c=this;c.client={},c.message={type:"success",content:null},c.closeMessage=function(){c.message.content=null},c.setMessage=function(a,b){c.message.type=a,c.message.content=b},c.client.contacts=[],c.addContact=function(){c.client.contacts.push({})},c.deleteContact=function(a){c.client.contacts.splice(a,1)},c.submit=function(){console.log(c.client),b.addNewClient(c.client).success(function(b){a.close(b)}).error(function(a){c.setMessage("danger","ERROR  : "+a.message)})},c.cancel=function(){a.dismiss("cancel")}}function patentClientController(a,b){var c=this;c.clients=a.data,c.newClientForm=function(){b.open({templateUrl:"js/patentClient/newClientForm.html",size:"med",backdrop:"static",controller:"newClientFormController",controllerAs:"vm",resolve:{allClients:function(){return c.clients}}})}}function patentEmailTemplateController(){var a=this;a.testEvent={status:"Active",patentExpirationDate:"",patentType:"Patent",filingDate:"2015-05-13T00:00:00",filingNumber:"104115268",country:"TW",issueNumber:"",clientId:"6101",chineseTitle:"電磁元件及其線圈結構",docketNumber:105,clientDocketNumber:"RD-101007-TW-1-D1",publicationDate:"",Comment:"",applicationType:"REG"}}function newPatentFormController(a,b,c){var d=this;d.patent={},d.clients=b,d.message={type:"success",content:null},d.closeMessage=function(){d.message.content=null},d.setMessage=function(a,b){d.message.type=a,d.message.content=b},d.patent.active=!0,d.picker1=!1,d.dateOptions={},d.openDatePicker1=function(){d.picker1=!0},d.applicationTypes=["REG","DIV","CA","CIP","PRO"],d.picker={},d.patent.priority=[],d.addPriority=function(){d.patent.priority.push({})},d.openDatePicker=function(a){d.picker[a]=!0},d.deletePriority=function(a){d.patent.priority.splice(a,1)},d.patent.status="Active",d.statusIs=function(a){return a===d.patent.status},d.changeStatus=function(a){d.patent.status=a,d.statusIs("Allowed")||(d.patent.issueNumber="",d.patent.patentExpirationDate="")},d.patent.inventors=[],d.addInventor=function(){d.patent.inventors.push({})},d.deleteInventor=function(a){d.patent.inventors.splice(a,1)},d.listCountries=["US","TW","CN","JP","KR","EP"],d.submit=function(){console.log(d.patent),d.patent.patentType="Patent",d.patent.litronDocketNumber=d.patent.clientId+"."+d.patent.docketNumber+"."+d.patent.country.toUpperCase(),c.addNewPatent(d.patent).success(function(b){a.close(b)}).error(function(a){d.setMessage("danger","ERROR  : "+a.message)})},d.cancel=function(){a.dismiss("cancel")}}function patentDetailsController(a,b,c,d,e,f){var g=this;g.patents=c.allPatents,g.patent=null,g.eventHistory=d.data;for(var h=0;h<g.patents.length;h++)if(g.patents[h]._id===b.id){g.patent=g.patents[h];break}for(g.patent.filingDate=new Date(g.patent.filingDate),g.patent.publicationDate&&(g.patent.publicationDate=new Date(g.patent.publicationDate)),g.patent.patentExpirationDate&&(g.patent.patentExpirationDate=new Date(g.patent.patentExpirationDate)),h=0;h<g.patent.priority.length;h++)g.patent.priority[h].priorityDate=new Date(g.patent.priority[h].priorityDate);for(h=0;h<g.eventHistory.length;h++)g.eventHistory[h].eventDeadline=new Date(g.eventHistory[h].eventDeadline);g.listCountries=["US","TW","CN","JP","KR","EP"],g.applicationTypes=["REG","DIV","CA","CIP","PRO"],g.dateOptions={},g.openDatePicker=function(a){g.picker={},g.picker[a]=!0},g.addInventor=function(){g.editEnabled&&g.patent.inventors.push({})},g.deleteInventor=function(a){g.editEnabled&&g.patent.inventors.splice(a,1)},g.priorityDatePicker={},g.addPriority=function(){g.editEnabled&&g.patent.priority.push({})},g.openPriorityDatePicker=function(a){g.priorityDatePicker[a]=!0},g.deletePriority=function(a){g.editEnabled&&g.patent.priority.splice(a,1)},g.status={isCustomHeaderOpen:!1,isFirstOpen:!0,isFirstDisabled:!1},g.editEnabled=!1,g.oldPatent=null,g.enableEdit=function(){g.oldPatent=angular.copy(g.patent),g.editEnabled=!0},g.cancelEdit=function(){angular.copy(g.oldPatent,g.patent),g.editEnabled=!1},g.save=function(){f.updatePatent(g.patent,g.patent._id).success(function(){angular.copy(g.patent,g.oldPatent),g.editEnabled=!1}).error(function(a){alert(a)})},g["delete"]=function(){f.deletePatent(g.patent._id).success(function(){alert("deleted")}).error(function(a){console.log(a)})},g.newEvent={notificationEmails:[],notificationDates:[]},g.completeEvent=function(a){e.completeEvent(g.eventHistory[a]._id).success(function(){g.eventHistory[a].completed=!0}).error(function(a){console.log(a)})},g.deleteEvent=function(a){e.deleteEvent(g.eventHistory[a]._id).success(function(){g.eventHistory.splice(a,1)}).error(function(a){console.log(a)})},g.emailsList=[{id:1,label:"janiceshih@litron-intl.com"},{id:2,label:"mackteng@litron-intl.com"},{id:3,label:"miketeng@litron-intl.com"},{id:4,label:"wilasato@litron-intl.com"}],g.multiSettings={displayProp:"label",idProp:"label"},g.multiSettingsDate={displayProp:"label",idProp:"date"},g.addEvent=function(){if(!g.newEvent.eventName)return void alert("Must provide name of event");if(!g.newEvent.eventDeadline)return void alert("Must specify deadline");g.newComment=g.newEvent.eventName,g.newEvent.eventName=g.patent.clientId+"."+g.patent.docketNumber+"."+g.patent.country.toUpperCase()+" "+g.newEvent.eventName;for(var a=0;a<g.newEvent.notificationEmails.length;a++)g.newEvent.notificationEmails[a]=g.newEvent.notificationEmails[a].id;for(var a=0;a<g.newEvent.notificationDates.length;a++)g.newEvent.notificationDates[a]=g.newEvent.notificationDates[a].id;e.addEvent(g.patent._id,g.newEvent).success(function(){g.eventHistory.unshift(g.newEvent),g.addComment(),g.newEvent={notificationEmails:[],notificationDates:[]}}).error(function(){alert("Error adding event")})},g.addComment=function(){g.patent.comments.unshift(g.newComment),g.newComment="",g.save()},g.statusIs=function(a){return a===g.patent.status},g.changeStatus=function(a){g.editEnabled&&(g.patent.status=a),g.statusIs("Allowed")||(delete g.patent.issueNumber,delete g.patent.patentExpirationDate)},a.$watch("vm.newEvent.eventDeadline",function(a,b){g.datesList=[];for(var c=0,d=1;6>=d;d++){var e=new Date(a);e.setDate(e.getDate()-d),g.datesList.push({id:c++,label:d+" day(s) before",date:e})}for(var d=1;8>=d;d++){var e=new Date(a);e.setDate(e.getDate()-7*d),g.datesList.push({id:c++,label:d+" week(s) before",date:e})}})}function patentController(a,b,c){function d(a){for(;a.length<3;)a="0"+a;return a}var e=this;e.patents=a.data,e.clients=b.data;for(var f=0;f<e.patents.length;f++)e.patents[f].litronDocketNumber=e.patents[f].clientId+"."+d(e.patents[f].docketNumber.toString())+"."+e.patents[f].country.toUpperCase();e.gridOptions={enableFiltering:!0,data:e.patents,enablePaginationControls:!0,paginationPageSizes:[25,50,75],paginationPageSize:25,rowHeight:50,columnDefs:[{field:"litronDocketNumber",displayName:"Docket Number",cellTemplate:'<div class="ui-grid-cell-contents"><a href="#/manage/{{row.entity._id}}">{{row.entity.litronDocketNumber}}</a>'},{field:"clientDocketNumber",displayName:"Client Docket Number"},{field:"applicationType",displayName:"Application Type"},{field:"filingDate",displayName:"Filing Date",cellFilter:"date"},{field:"englishTitle",displayName:"English Title"},{field:"chineseTitle",displayName:"Chinese Title"},{field:"comments[0]",displayName:"LastActivity"},{field:"status",displayName:"Status"}]},e.advancedSearchCollapse=!0,e.toggleAdvancedSearch=function(){e.advancedSearchCollapse=!e.advancedSearchCollapse},e.orderProperty="clientId",e.reverse=!1,e.changeOrder=function(a){e.orderProperty===a?e.reverse=!e.reverse:(e.reverse=!1,e.orderProperty=a)},e.newPatentForm=function(){var a=c.open({templateUrl:"js/patentManager/newPatentForm.html",size:"med",backdrop:"static",controller:"newPatentFormController",controllerAs:"vm",resolve:{allClients:function(){return e.clients}}});a.result.then(function(a){e.patents.push(a)})}}function patentService(a,b,c){var d=null,e=b.baseUrl,f={},g=!1;return f.listAllPatents=function(){return g||null==d?f.getAllPatents():d},f.getAllPatents=function(){return a.get(e+"patents/",{headers:{Authorization:"Bearer "+c.getToken()}}).then(function(a){return d=a,a},function(a){console.log(a)})},f.addNewPatent=function(b){return a.post(e+"patents/",b,{headers:{Authorization:"Bearer "+c.getToken()}})},f.updatePatent=function(b,d){return a.put(e+"patents/"+d,b,{headers:{Authorization:"Bearer "+c.getToken()}})},f.deletePatent=function(b,d){return a["delete"](e+"patents/"+d,{headers:{Authorization:"Bearer "+c.getToken()}})},f.markUpdated=function(){g=!0},f.getAllPatents(),f}function routeConfig(a,b){b.otherwise("manage"),a.state("overview",{url:"/overview",templateUrl:"js/patentCalendar/calendar.html",controller:"calendarController",controllerAs:"vm",resolve:{allEvents:allEvents}}).state("manage",{url:"/manage",templateUrl:"js/patentManager/patentManager.html",controller:"patentController",controllerAs:"vm",resolve:{allPatents:allPatents,allClients:allClients}}).state("manage.details",{url:"/:id",templateUrl:"js/patentManager/patentDetails.html",controller:"patentDetailsController",controllerAs:"vm",resolve:{eventHistory:getEventHistory,patent:allPatentsChild}}).state("clients",{url:"/clients",templateUrl:"js/patentClient/patentClient.html",controller:"patentClientController",controllerAs:"vm",resolve:{allClients:allClients}}).state("clients.details",{url:"/:clientid",templateUrl:"js/patentClient/clientDetails.html",controller:"clientDetailsController",controllerAs:"vm",resolve:{client:allClientsChild}}).state("emailTemplates",{url:"/emailTemplates",templateUrl:"js/patentEmailTemplate/patentEmailTemplate.html",controller:"patentEmailTemplateController",controllerAs:"vm"}).state("login",{url:"/login",templateUrl:"js/auth/login/login.html",controller:"loginController",controllerAs:"vm"})}function allEvents(a){return a.listAllEvents()}function getEventHistory(a,b){return a.getEventHistory(b.id)}function allPatentsChild(a){return{allPatents:a.data}}function allPatents(a){return a.listAllPatents()}function allClientsChild(a){return{allClients:a.data}}function allClients(a){return a.listAllClients()}angular.module("patentApp",["ui.bootstrap","ui.router","ngCookies","ui.calendar","angularjs-dropdown-multiselect","ui.grid","ui.grid.pagination","ui.grid.resizeColumns"]),angular.module("patentApp").factory("authentication",["$window","config","$http",authentication]),angular.module("patentApp").controller("loginController",["authentication","$state",loginController]),angular.module("patentApp").factory("clientService",["$http","config","authentication",clientService]),angular.module("patentApp").constant("config",{baseUrl:"api/"}),angular.module("patentApp").factory("eventService",["$http","config","authentication",eventService]),angular.module("patentApp").controller("calendarController",calendarController),calendarController.$inject=["allEvents"],angular.module("patentApp").controller("clientDetailsController",clientDetailsController),clientDetailsController.$inject=["$stateParams","client","clientService"],angular.module("patentApp").controller("newClientFormController",newClientFormController),newClientFormController.$inject=["$uibModalInstance","clientService"],angular.module("patentApp").controller("patentClientController",patentClientController),patentClientController.$inject=["allClients","$uibModal"],angular.module("patentApp").controller("patentEmailTemplateController",patentEmailTemplateController),angular.module("patentApp").controller("newPatentFormController",newPatentFormController),newPatentFormController.$inject=["$uibModalInstance","allClients","patentService"],angular.module("patentApp").controller("patentDetailsController",patentDetailsController),patentDetailsController.$inject=["$scope","$stateParams","patent","eventHistory","eventService","patentService"],angular.module("patentApp").controller("patentController",patentController),patentController.$inject=["allPatents","allClients","$uibModal","$log"],angular.module("patentApp").factory("patentService",["$http","config","authentication",patentService]),angular.module("patentApp").config(["$stateProvider","$urlRouterProvider",routeConfig]),angular.module("patentApp").run(["$rootScope","$state","$location","authentication",function(a,b,c,d){a.$on("$stateChangeStart",function(a,c,e,f){return"login"==c.name||d.isLoggedIn()?void 0:(b.go("login"),void a.preventDefault())})}]),allEvents.$inject=["eventService"],getEventHistory.$inject=["eventService","$stateParams"],allPatentsChild.$inject=["allPatents"],allPatents.$inject=["patentService"],allClientsChild.$inject=["allClients"],allClients.$inject=["clientService"];