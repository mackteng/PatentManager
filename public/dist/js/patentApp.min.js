function authentication(a,b,c){var d=b.baseUrl,e=function(b){a.localStorage.token=b},f=function(b){return a.localStorage.token},g=function(a){return c.post(d+"register/",a).success(function(a){e(a)})},h=function(a){return c.post(d+"login/",a).success(function(a){e(a)})},i=function(){a.localStorage.removeItem("loc8r-token")},j=function(){var b=f();if(b){var c=JSON.parse(a.atob(b.split(".")[1]));return c.exp>Date.now()/1e3}return!1},k=function(){if(j()){var b=f(),c=JSON.parse(a.atob(b.split(".")[1]));return{email:c.email,name:c.name}}};return{saveToken:e,getToken:f,register:g,login:h,logout:i,isLoggedIn:j,currentUser:k}}function loginController(a,b){var c=this;c.error="",c.login=function(){c.email&&c.password?a.login({email:c.email,password:c.password}).error(function(a){c.error=a.message,c.email="",c.password=""}).then(function(){b.go("overview")}):alert("Both fields must be filled in")}}function clientService(a,b,c){var d=b.baseUrl,e={};return e.listAllClients=function(){return a.get(d+"clients/",{headers:{Authorization:"Bearer "+c.getToken()}})},e.addNewClient=function(b){return a.post(d+"clients/",b,{headers:{Authorization:"Bearer "+c.getToken()}})},e.updateClient=function(b){return a.put(d+"clients/"+b._id,b,{headers:{Authorization:"Bearer "+c.getToken()}})},e}function eventService(a,b,c){var d=b.baseUrl,e={};return e.listAllEvents=function(){return a.get(d+"/events",{headers:{Authorization:"Bearer "+c.getToken()}})},e.getEventHistory=function(b){return a.get(d+"/patents/"+b+"/events",{headers:{Authorization:"Bearer "+c.getToken()}})},e.addEvent=function(b,e){return a.post(d+"/patents/"+b+"/events",e,{headers:{Authorization:"Bearer "+c.getToken()}})},e.completeEvent=function(b){return a.put(d+"/events/"+b,{complete:!0},{headers:{Authorization:"Bearer "+c.getToken()}})},e.deleteEvent=function(b){return a.delete(d+"/events/"+b,{headers:{Authorization:"Bearer "+c.getToken()}})},e}function invoiceService(a,b,c){var d=b.baseUrl,e={};return e.listAllInvoices=function(){return a.get(d+"/invoices",{headers:{Authorization:"Bearer "+c.getToken()}})},e.deleteInvoice=function(b){return a.delete(d+"/invoices/"+b,{headers:{Authorization:"Bearer "+c.getToken()}})},e.populateInvoice=function(b){return a.get(d+"/invoices/"+b,{complete:!0},{headers:{Authorization:"Bearer "+c.getToken()}})},e}function calendarController(a){var b=this;b.events=a.data,b.eventSources={events:[]},b.config={calendar:{height:800,header:{left:"month basicWeek basicDay",center:"title",right:"today prev,next"}}};for(var c=0;c<b.events.length;c++)0==b.events[c].completed&&b.eventSources.events.push({title:b.events[c].eventName,start:new Date(b.events[c].eventDeadline),url:"#/manage/"+b.events[c].patentID})}function clientDetailsController(a,b,c){var d=this;d.clients=b.allClients;for(var e=0;e<d.clients.length;e++)if(d.clients[e]._id===a.clientid){d.client=d.clients[e];break}d.addContact=function(){d.editEnabled&&d.client.contacts.push({})},d.deleteContact=function(a){d.editEnabled&&d.client.contacts.splice(a,1)},d.editEnabled=!1,d.oldClient=null,d.enableEdit=function(){d.oldClient=angular.copy(d.client),d.editEnabled=!0},d.cancelEdit=function(){angular.copy(d.oldPatent,d.patent),d.editEnabled=!1},d.save=function(){c.updateClient(d.client,d.client._id).success(function(){angular.copy(d.client,d.oldClient),d.editEnabled=!1}).error(function(a){alert(a),d.cancelEdit()})}}function newClientFormController(a,b){var c=this;c.client={},c.message={type:"success",content:null},c.closeMessage=function(){c.message.content=null},c.setMessage=function(a,b){c.message.type=a,c.message.content=b},c.client.contacts=[],c.addContact=function(){c.client.contacts.push({})},c.deleteContact=function(a){c.client.contacts.splice(a,1)},c.submit=function(){console.log(c.client),b.addNewClient(c.client).success(function(b){a.close(b)}).error(function(a){c.setMessage("danger","ERROR  : "+a.message)})},c.cancel=function(){a.dismiss("cancel")}}function patentClientController(a,b){var c=this;c.clients=a.data,c.newClientForm=function(){var a=b.open({templateUrl:"js/patentClient/newClientForm.html",size:"med",backdrop:"static",controller:"newClientFormController",controllerAs:"vm",resolve:{allClients:function(){return c.clients}}});a.result.then(function(a){c.clients.push(a)})}}function patentEmailTemplateController(a){var b=this;b.testEvent={status:"Active",patentExpirationDate:"",patentType:"Patent",filingDate:"2015-05-13T00:00:00",filingNumber:"104115268",country:"TW",issueNumber:"",clientId:"6101",chineseTitle:"電磁元件及其線圈結構",docketNumber:105,clientDocketNumber:"RD-101007-TW-1-D1",publicationDate:"",Comment:"",applicationType:"REG"},b.gmailURL=a.trustAsResourceUrl("http://mail.google.com/mail/?compose=1&view=cm&fs=1"),b.populatedBody="hello"}function patentInvoiceTemplateController(a,b){var c=this;c.invoices=b.data,c.testEvent={status:"Active",patentExpirationDate:"",patentType:"Patent",filingDate:"2015-05-13T00:00:00",filingNumber:"104115268",country:"TW",issueNumber:"",clientId:"6101",chineseTitle:"電磁元件及其線圈結構",docketNumber:105,clientDocketNumber:"RD-101007-TW-1-D1",publicationDate:"",Comment:"",applicationType:"REG"},c.uploadFile=function(b){c.f=b,b&&(b.upload=a.upload({url:"api/invoices",data:{file:b}}),b.upload.then(function(a){c.invoices.push(b.name)},function(a){a.status>0&&(c.errorMsg=a.status+": "+a.data)},function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total))}))}}function invoiceMenuController(a,b,c){var d=this;d.invoices=b.data,d.patentId=c,d.dismiss=function(){a.dismiss("cancel")}}function newPatentFormController(a,b,c){var d=this;d.patent={},d.clients=b,d.message={type:"success",content:null},d.closeMessage=function(){d.message.content=null},d.setMessage=function(a,b){d.message.type=a,d.message.content=b},d.patent.active=!0,d.picker1=!1,d.dateOptions={},d.openDatePicker1=function(){d.picker1=!0},d.applicationTypes=["REG","DIV","CA","CIP","PRO"],d.picker={},d.patent.priority=[],d.addPriority=function(){d.patent.priority.push({})},d.openDatePicker=function(a){d.picker[a]=!0},d.deletePriority=function(a){d.patent.priority.splice(a,1)},d.patent.status="Active",d.statusIs=function(a){return a===d.patent.status},d.changeStatus=function(a){d.patent.status=a,d.statusIs("Allowed")||(d.patent.issueNumber="",d.patent.patentExpirationDate="")},d.patent.inventors=[],d.addInventor=function(){d.patent.inventors.push({})},d.deleteInventor=function(a){d.patent.inventors.splice(a,1)},d.listCountries=["US","TW","CN","JP","KR","EP"],d.submit=function(){console.log(d.patent),d.patent.patentType="Patent",c.addNewPatent(d.patent).success(function(b){a.close(b)}).error(function(a){d.setMessage("danger","ERROR  : "+a.message)})},d.cancel=function(){a.dismiss("cancel")}}function patentDetailsController(a,b,c,d,e,f,g,h){var i=this;i.patents=d.allPatents,i.patent=null,i.eventHistory=e.data;for(var j=0;j<i.patents.length;j++)if(i.patents[j]._id===b.id){i.patent=i.patents[j];break}for(i.patent.filingDate=new Date(i.patent.filingDate),i.patent.publicationDate&&(i.patent.publicationDate=new Date(i.patent.publicationDate)),i.patent.patentExpirationDate&&(i.patent.patentExpirationDate=new Date(i.patent.patentExpirationDate)),j=0;j<i.patent.priority.length;j++)i.patent.priority[j].priorityDate=new Date(i.patent.priority[j].priorityDate);for(j=0;j<i.eventHistory.length;j++)i.eventHistory[j].eventDeadline=new Date(i.eventHistory[j].eventDeadline);i.listCountries=["US","TW","CN","JP","KR","EP"],i.applicationTypes=["REG","DIV","CA","CIP","PRO"],i.dateOptions={},i.openDatePicker=function(a){i.picker={},i.picker[a]=!0},i.addInventor=function(){i.editEnabled&&i.patent.inventors.push({})},i.deleteInventor=function(a){i.editEnabled&&i.patent.inventors.splice(a,1)},i.priorityDatePicker={},i.addPriority=function(){i.editEnabled&&i.patent.priority.push({})},i.openPriorityDatePicker=function(a){i.priorityDatePicker[a]=!0},i.deletePriority=function(a){i.editEnabled&&i.patent.priority.splice(a,1)},i.status={isCustomHeaderOpen:!1,isFirstOpen:!0,isFirstDisabled:!1},i.editEnabled=!1,i.oldPatent=null,i.enableEdit=function(){i.oldPatent=angular.copy(i.patent),i.editEnabled=!0},i.cancelEdit=function(){angular.copy(i.oldPatent,i.patent),i.editEnabled=!1},i.save=function(){g.updatePatent(i.patent,i.patent._id).success(function(){angular.copy(i.patent,i.oldPatent),i.editEnabled=!1}).error(function(a){alert(a)})},i.delete=function(){g.deletePatent(i.patent._id).success(function(){alert("deleted")}).error(function(a){console.log(a)})},i.newEvent={notificationEmails:[],notificationDates:[]},i.completeEvent=function(a){f.completeEvent(i.eventHistory[a]._id).success(function(){i.eventHistory[a].completed=!0}).error(function(a){console.log(a)})},i.deleteEvent=function(a){f.deleteEvent(i.eventHistory[a]._id).success(function(){i.eventHistory.splice(a,1)}).error(function(a){console.log(a)})},i.emailsList=[{id:1,label:"janiceshih@litron-intl.com"},{id:2,label:"mackteng@litron-intl.com"},{id:3,label:"miketeng@litron-intl.com"},{id:4,label:"wilasato@litron-intl.com"}],i.multiSettings={displayProp:"label",idProp:"label"},i.multiSettingsDate={displayProp:"label",idProp:"date"},i.addEvent=function(){if(!i.newEvent.eventName)return void alert("Must provide name of event");if(!i.newEvent.eventDeadline)return void alert("Must specify deadline");i.newComment=i.newEvent.eventName,i.newEvent.eventName=i.patent.clientId+"."+i.patent.docketNumber+"."+i.patent.country.toUpperCase()+" "+i.newEvent.eventName;for(var a=0;a<i.newEvent.notificationEmails.length;a++)i.newEvent.notificationEmails[a]=i.newEvent.notificationEmails[a].id;for(var a=0;a<i.newEvent.notificationDates.length;a++)i.newEvent.notificationDates[a]=i.newEvent.notificationDates[a].id;f.addEvent(i.patent._id,i.newEvent).success(function(){i.eventHistory.unshift(i.newEvent),i.addComment(),i.newEvent={notificationEmails:[],notificationDates:[]}}).error(function(){alert("Error adding event")})},i.addComment=function(){i.patent.comments.unshift(i.newComment),i.newComment="",i.save()},i.statusIs=function(a){return a===i.patent.status},i.changeStatus=function(a){i.editEnabled&&(i.patent.status=a),i.statusIs("Allowed")||(delete i.patent.issueNumber,delete i.patent.patentExpirationDate)},a.$watch("vm.newEvent.eventDeadline",function(a,b){i.datesList=[];for(var c=0,d=1;d<=6;d++){var e=new Date(a);e.setDate(e.getDate()-d),i.datesList.push({id:c++,label:d+" day(s) before",date:e})}for(var d=1;d<=8;d++){var e=new Date(a);e.setDate(e.getDate()-7*d),i.datesList.push({id:c++,label:d+" week(s) before",date:e})}}),i.invoice=function(){c.open({templateUrl:"js/patentManager/invoiceMenu.html",size:"small",backdrop:"static",controller:"invoiceMenuController",controllerAs:"vm",resolve:{allInvoices:function(){return h.listAllInvoices()},patentId:function(){return i.patent._id}}})}}function patentController(a,b,c){var d=this;d.patents=a.data,d.clients=b.data,d.gridOptions={enableFiltering:!0,data:d.patents,enablePaginationControls:!0,paginationPageSizes:[25,50,75],paginationPageSize:25,rowHeight:50,columnDefs:[{field:"litronDocketNumber",displayName:"Docket Number",cellTemplate:'<div class="ui-grid-cell-contents"><a href="#/manage/{{row.entity._id}}">{{row.entity.litronDocketNumber}}</a>'},{field:"clientDocketNumber",displayName:"Client Docket Number"},{field:"applicationType",displayName:"Application Type"},{field:"country",displayName:"Country"},{field:"filingDate",displayName:"Filing Date",cellFilter:"date"},{field:"englishTitle",displayName:"English Title"},{field:"chineseTitle",displayName:"Chinese Title"},{field:"status",displayName:"Status"}]},d.advancedSearchCollapse=!0,d.toggleAdvancedSearch=function(){d.advancedSearchCollapse=!d.advancedSearchCollapse},d.orderProperty="clientId",d.reverse=!1,d.changeOrder=function(a){d.orderProperty===a?d.reverse=!d.reverse:(d.reverse=!1,d.orderProperty=a)},d.newPatentForm=function(){var a=c.open({templateUrl:"js/patentManager/newPatentForm.html",size:"med",backdrop:"static",controller:"newPatentFormController",controllerAs:"vm",resolve:{allClients:function(){return d.clients}}});a.result.then(function(a){d.patents.push(a)})}}function patentService(a,b,c){var d=null,e=b.baseUrl,f={},g=!1;return f.listAllPatents=function(){return g||null==d?f.getAllPatents():d},f.getAllPatents=function(){return a.get(e+"patents/",{headers:{Authorization:"Bearer "+c.getToken()}}).then(function(a){return d=a,a},function(a){console.log(a)})},f.addNewPatent=function(b){return a.post(e+"patents/",b,{headers:{Authorization:"Bearer "+c.getToken()}})},f.updatePatent=function(b,d){return a.put(e+"patents/"+d,b,{headers:{Authorization:"Bearer "+c.getToken()}})},f.deletePatent=function(b,d){return a.delete(e+"patents/"+d,{headers:{Authorization:"Bearer "+c.getToken()}})},f.markUpdated=function(){g=!0},f.getAllPatents(),f}function routeConfig(a,b){b.otherwise("manage"),a.state("overview",{url:"/overview",templateUrl:"js/patentCalendar/calendar.html",controller:"calendarController",controllerAs:"vm",resolve:{allEvents:allEvents}}).state("manage",{url:"/manage",templateUrl:"js/patentManager/patentManager.html",controller:"patentController",controllerAs:"vm",resolve:{allPatents:allPatents,allClients:allClients}}).state("manage.details",{url:"/:id",templateUrl:"js/patentManager/patentDetails.html",controller:"patentDetailsController",controllerAs:"vm",resolve:{eventHistory:getEventHistory,patent:allPatentsChild}}).state("clients",{url:"/clients",templateUrl:"js/patentClient/patentClient.html",controller:"patentClientController",controllerAs:"vm",resolve:{allClients:allClients}}).state("clients.details",{url:"/:clientid",templateUrl:"js/patentClient/clientDetails.html",controller:"clientDetailsController",controllerAs:"vm",resolve:{client:allClientsChild}}).state("emailTemplates",{url:"/emailTemplates",templateUrl:"js/patentEmailTemplate/patentEmailTemplate.html",controller:"patentEmailTemplateController",controllerAs:"vm"}).state("invoiceTemplates",{url:"/invoiceTemplates",templateUrl:"js/patentInvoiceTemplate/patentInvoiceTemplate.html",controller:"patentInvoiceTemplateController",controllerAs:"vm",resolve:{invoices:allInvoices}}).state("login",{url:"/login",templateUrl:"js/auth/login/login.html",controller:"loginController",controllerAs:"vm"})}function allInvoices(a){return a.listAllInvoices()}function allEvents(a){return a.listAllEvents()}function getEventHistory(a,b){return a.getEventHistory(b.id)}function allPatentsChild(a){return{allPatents:a.data}}function allPatents(a){return a.listAllPatents()}function allClientsChild(a){return{allClients:a.data}}function allClients(a){return a.listAllClients()}angular.module("patentApp",["ui.bootstrap","ui.router","ngCookies","ui.calendar","angularjs-dropdown-multiselect","ui.grid","ui.grid.pagination","ui.grid.resizeColumns","ngFileUpload"]),angular.module("patentApp").factory("authentication",["$window","config","$http",authentication]),angular.module("patentApp").controller("loginController",["authentication","$state",loginController]),angular.module("patentApp").factory("clientService",["$http","config","authentication",clientService]),angular.module("patentApp").constant("config",{baseUrl:"api/"}),angular.module("patentApp").factory("eventService",["$http","config","authentication",eventService]),angular.module("patentApp").factory("invoiceService",["$http","config","authentication",invoiceService]),angular.module("patentApp").controller("calendarController",calendarController),calendarController.$inject=["allEvents"],angular.module("patentApp").controller("clientDetailsController",clientDetailsController),clientDetailsController.$inject=["$stateParams","client","clientService"],angular.module("patentApp").controller("newClientFormController",newClientFormController),newClientFormController.$inject=["$uibModalInstance","clientService"],angular.module("patentApp").controller("patentClientController",patentClientController),patentClientController.$inject=["allClients","$uibModal"],angular.module("patentApp").controller("patentEmailTemplateController",patentEmailTemplateController),patentEmailTemplateController.$inject=["$sce"],angular.module("patentApp").controller("patentInvoiceTemplateController",patentInvoiceTemplateController),patentInvoiceTemplateController.$inject=["Upload","invoices"],angular.module("patentApp").controller("invoiceMenuController",invoiceMenuController),invoiceMenuController.$inject=["$uibModalInstance","allInvoices","patentId"],angular.module("patentApp").controller("newPatentFormController",newPatentFormController),newPatentFormController.$inject=["$uibModalInstance","allClients","patentService"],angular.module("patentApp").controller("patentDetailsController",patentDetailsController),patentDetailsController.$inject=["$scope","$stateParams","$uibModal","patent","eventHistory","eventService","patentService","invoiceService"],angular.module("patentApp").controller("patentController",patentController),patentController.$inject=["allPatents","allClients","$uibModal","$log"],angular.module("patentApp").factory("patentService",["$http","config","authentication",patentService]),angular.module("patentApp").config(["$stateProvider","$urlRouterProvider",routeConfig]),angular.module("patentApp").run(["$rootScope","$state","$location","authentication",function(a,b,c,d){a.$on("$stateChangeStart",function(a,c,e,f){if("login"!=c.name&&!d.isLoggedIn())return b.go("login"),void a.preventDefault()})}]),allInvoices.$inject=["invoiceService"],allEvents.$inject=["eventService"],getEventHistory.$inject=["eventService","$stateParams"],allPatentsChild.$inject=["allPatents"],allPatents.$inject=["patentService"],allClientsChild.$inject=["allClients"],allClients.$inject=["clientService"];