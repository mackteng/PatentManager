function authentication(a,b,c){var d=b.baseUrl,e=function(b){a.localStorage.token=b},f=function(b){return a.localStorage.token},g=function(a){return c.post(d+"register/",a).success(function(a){e(a)})},h=function(a){return c.post(d+"login/",a).success(function(a){e(a)})},i=function(){a.localStorage.removeItem("loc8r-token")},j=function(){var b=f();if(b){var c=JSON.parse(a.atob(b.split(".")[1]));return c.exp>Date.now()/1e3}return!1},k=function(){if(j()){var b=f(),c=JSON.parse(a.atob(b.split(".")[1]));return{email:c.email,name:c.name}}};return{saveToken:e,getToken:f,register:g,login:h,logout:i,isLoggedIn:j,currentUser:k}}function loginController(a,b){var c=this;c.error="",c.login=function(){c.email&&c.password?a.login({email:c.email,password:c.password}).error(function(a){c.error=a.message,c.email="",c.password=""}).then(function(){b.go("overview")}):alert("Both fields must be filled in")}}function clientService(a,b,c){var d=b.baseUrl,e={};return e.listAllClients=function(){return a.get(d+"clients/",{headers:{Authorization:"Bearer "+c.getToken()}})},e}function eventService(a,b,c){var d=b.baseUrl,e={};return e.listAllEvents=function(){return a.get(d+"/events",{headers:{Authorization:"Bearer "+c.getToken()}})},e.getEventHistory=function(b){return a.get(d+"/patents/"+b+"/events",{headers:{Authorization:"Bearer "+c.getToken()}})},e.addEvent=function(b,e){return a.post(d+"/patents/"+b+"/events",e,{headers:{Authorization:"Bearer "+c.getToken()}})},e}function overviewController(a){var b=this;b.events=a.data,b.eventSources={events:[]},b.config={calendar:{height:800,header:{left:"month basicWeek basicDay",center:"title",right:"today prev,next"}}};for(var c=0;c<b.events.length;c++)0==b.events[c].completed&&b.eventSources.events.push({title:b.events[c].eventName,start:new Date(b.events[c].eventDeadline),url:"starter.html#/manage/"+b.events[c].patentID})}function newPatentFormController(a,b,c){var d=this;d.patent={},d.clients=b,d.message={type:"success",content:null},d.closeMessage=function(){d.message.content=null},d.setMessage=function(a,b){d.message.type=a,d.message.content=b},d.patent.active=!0,d.picker1=!1,d.picker2=!1,d.dateOptions={},d.openDatePicker1=function(){d.picker1=!0},d.openDatePicker2=function(){d.picker2=!0},d.applicationTypes=["Patent"],d.enablePriorityForm=!1,d.clearPriority=function(){delete d.patent.priority},d.patent.inventors=[],d.addInventor=function(){d.patent.inventors.push({})},d.deleteInventor=function(a){d.patent.inventors.splice(a,1)},d.listCountries=["US","TW","CN","JP","KR","EU"],d.submit=function(){c.addNewPatent(d.patent).success(function(b){a.close(b)}).error(function(a){d.setMessage("danger","ERROR  : "+a.message)})},d.cancel=function(){a.dismiss("cancel")}}function patentDetailsController(a,b,c,d,e,f){var g=this;g.patents=c.allPatents,g.patent=null,g.eventHistory=d.data;for(var h=0;h<g.patents.length;h++)if(g.patents[h]._id==b.id){g.patent=g.patents[h];break}for(g.patent.filingDate=new Date(g.patent.filingDate),g.patent.priority&&(g.patent.priority.priorityDate=new Date(g.patent.priority.priorityDate)),h=0;h<g.eventHistory.length;h++)g.eventHistory[h].eventDeadline=new Date(g.eventHistory[h].eventDeadline);g.enablePriorityForm=null!=g.patent.priority,g.listCountries=["US","TW","CN","JP","KR","EU"],g.applicationTypes=["Patent"],g.picker1=!1,g.picker2=!1,g.picker3=!1,g.dateOptions={},g.openDatePicker1=function(){g.picker1=!0},g.openDatePicker2=function(){g.picker2=!0},g.openDatePicker3=function(){g.picker3=!0},g.addInventor=function(){g.editEnabled&&g.patent.inventors.push({})},g.deleteInventor=function(a){g.patent.inventors.splice(a,1)},g.status={isCustomHeaderOpen:!1,isFirstOpen:!0,isFirstDisabled:!1},g.editEnabled=!1,g.oldPatent=null,g.enableEdit=function(){g.oldPatent=angular.copy(g.patent),g.editEnabled=!0},g.cancelEdit=function(){angular.copy(g.oldPatent,g.patent),g.editEnabled=!1},g.save=function(){f.updatePatent(g.patent,g.patent._id).success(function(){angular.copy(g.patent,g.oldPatent),g.editEnabled=!1}).error(function(a){alert(a)})},g["delete"]=function(){f.deletePatent(g.patent._id).success(function(){alert("deleted")}).error(function(a){console.log(a)})},g.newEvent={notificationEmails:[],notificationDates:[]},g.emailsList=[{id:1,label:"janiceshih@litron-intl.com"},{id:2,label:"mackteng@litron-intl.com"},{id:3,label:"miketeng@litron-intl.com"},{id:4,label:"wilasato@litron-intl.com"}],g.multiSettings={displayProp:"label",idProp:"label"},g.multiSettingsDate={displayProp:"label",idProp:"date"},g.addEvent=function(){if(console.log(g.newEvent),!g.newEvent.eventName)return void alert("Must provide name of event");if(!g.newEvent.eventDeadline)return void alert("Must specify deadline");g.newEvent.eventName=g.patent.clientId+"."+g.patent.docketNumber+"."+g.patent.country.toUpperCase()+" "+g.newEvent.eventName;for(var a=0;a<g.newEvent.notificationEmails.length;a++)g.newEvent.notificationEmails[a]=g.newEvent.notificationEmails[a].id;for(var a=0;a<g.newEvent.notificationDates.length;a++)g.newEvent.notificationDates[a]=g.newEvent.notificationDates[a].id;e.addEvent(g.patent._id,g.newEvent).success(function(){g.eventHistory.unshift(g.newEvent),g.lastDeadline=g.newEvent,g.newEvent={notificationEmails:[],notificationDates:[]},f.markUpdated()}).error(function(){alert("Error adding event")})},g.addComment=function(){g.patent.comments.push(g.newComment),g.newComment="",g.save()},g.displayStatus=function(a){return!(a===g.patent.status)},g.changeStatus=function(a){g.editEnabled&&(g.patent.status=a)},a.$watch("vm.newEvent.eventDeadline",function(a,b){g.datesList=[];for(var c=0,d=1;6>=d;d++){var e=new Date(a);e.setDate(e.getDate()-d),g.datesList.push({id:c++,label:d+" day(s) before",date:e})}for(var d=1;8>=d;d++){var e=new Date(a);e.setDate(e.getDate()-7*d),g.datesList.push({id:c++,label:d+" week(s) before",date:e})}})}function patentController(a,b,c){var d=this;d.patents=a.data,d.clients=b.data,console.log(d.patents),d.advancedSearchCollapse=!0,d.toggleAdvancedSearch=function(){d.advancedSearchCollapse=!d.advancedSearchCollapse},d.orderProperty="clientId",d.reverse=!1,d.changeOrder=function(a){d.orderProperty===a?d.reverse=!d.reverse:(d.reverse=!1,d.orderProperty=a)},d.newPatentForm=function(){var a=c.open({templateUrl:"js/patentManager/newPatentForm.html",size:"med",backdrop:"static",controller:"newPatentFormController",controllerAs:"vm",resolve:{allClients:function(){return d.clients}}});a.result.then(function(a){d.patents.push(a)})}}function patentService(a,b,c){var d=null,e=b.baseUrl,f={},g=!1;return f.listAllPatents=function(){return g||null==d?f.getAllPatents():d},f.getAllPatents=function(){return a.get(e+"patents/",{headers:{Authorization:"Bearer "+c.getToken()}}).then(function(a){return d=a,a},function(a){console.log(a)})},f.addNewPatent=function(b){return a.post(e+"patents/",b,{headers:{Authorization:"Bearer "+c.getToken()}})},f.updatePatent=function(b,d){return a.put(e+"patents/"+d,b,{headers:{Authorization:"Bearer "+c.getToken()}})},f.deletePatent=function(b,d){return a["delete"](e+"patents/"+d,{headers:{Authorization:"Bearer "+c.getToken()}})},f.markUpdated=function(){g=!0},f.getAllPatents(),f}function routeConfig(a,b){a.state("overview",{url:"/overview",templateUrl:"js/overview/overview.html",controller:"overviewController",controllerAs:"vm",resolve:{allEvents:allEvents}}).state("manage",{url:"/manage",templateUrl:"js/patentManager/patentManager.html",controller:"patentController",controllerAs:"vm",resolve:{allPatents:allPatents,allClients:allClients}}).state("manage.details",{url:"/:id",templateUrl:"js/patentManager/patentDetails.html",controller:"patentDetailsController",controllerAs:"vm",resolve:{eventHistory:getEventHistory,patent:allPatentsChild}}).state("login",{url:"/login",templateUrl:"js/auth/login/login.html",controller:"loginController",controllerAs:"vm"})}function allEvents(a){return a.listAllEvents()}function getEventHistory(a,b){return a.getEventHistory(b.id)}function allPatentsChild(a){return{allPatents:a.data}}function allPatents(a){return a.listAllPatents()}function allClients(a){return a.listAllClients()}angular.module("patentApp",["ui.bootstrap","ui.router","ngCookies","ui.calendar","angularjs-dropdown-multiselect"]),angular.module("patentApp").factory("authentication",["$window","config","$http",authentication]),angular.module("patentApp").controller("loginController",["authentication","$state",loginController]),angular.module("patentApp").factory("clientService",["$http","config","authentication",clientService]),angular.module("patentApp").constant("config",{baseUrl:"http://192.168.19.157/api/"}),angular.module("patentApp").factory("eventService",["$http","config","authentication",eventService]),angular.module("patentApp").controller("overviewController",overviewController),overviewController.$inject=["allEvents"],angular.module("patentApp").controller("newPatentFormController",newPatentFormController),newPatentFormController.$inject=["$uibModalInstance","allClients","patentService"],angular.module("patentApp").controller("patentDetailsController",patentDetailsController),patentDetailsController.$inject=["$scope","$stateParams","patent","eventHistory","eventService","patentService"],angular.module("patentApp").controller("patentController",patentController),patentController.$inject=["allPatents","allClients","$uibModal","$log"],angular.module("patentApp").factory("patentService",["$http","config","authentication",patentService]),angular.module("patentApp").config(["$stateProvider","$urlRouterProvider",routeConfig]),angular.module("patentApp").run(["$rootScope","$state","$location","authentication",function(a,b,c,d){a.$on("$stateChangeStart",function(a,c,e,f){return"login"==c.name||d.isLoggedIn()?void 0:(b.go("login"),void a.preventDefault())})}]),allEvents.$inject=["eventService"],getEventHistory.$inject=["eventService","$stateParams"],allPatentsChild.$inject=["allPatents"],allPatents.$inject=["patentService"],allClients.$inject=["clientService"];